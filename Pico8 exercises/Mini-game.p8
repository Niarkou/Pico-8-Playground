pico-8 cartridge // http://www.pico-8.com
version 18
__lua__

#include ../escarlib/vec.lua

function _init()
    vit=1/6
    player={pos=vec2(7,7),vel=vec2(0,0)}
    ennemies={}
    for i=1,10 do
        add(ennemies, {pos=vec2(rnd(15),rnd(15)),vel=vec2(0,0),path=abs(rnd(2))})
    end
end

function _update()
    player.vel=vec2(0,0)
    if btn(0) then
        player.vel.x=-vit
    end
    if btn(1) then
        player.vel.x=vit
    end
    if btn(2) then
        player.vel.y=-vit
    end
    if btn(3) then
        player.vel.y=vit
    end
        player.pos+=player.vel

    foreach(ennemies, function(e)
        if e.path < 1 then
            if length(player.pos-e.pos) > 1 then
                e.vel=normalize(player.pos-e.pos)/8
                e.pos+=e.vel
            end
        elseif e.path < 2 then
            if length((player.pos+player.vel*128)-e.pos) > 1 then
                e.vel=normalize((player.pos+player.vel*8)-e.pos)/8
                e.pos+=e.vel
            end
        end
    end)
end

function _draw()
    cls(1)
    spr(1,player.pos.x*8,player.pos.y*8)
    foreach(ennemies, function(e)
        spr(2,e.pos.x*8,e.pos.y*8)
    end)
end

__gfx__
0000000090909090f000000f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000090909090f0000f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000009090909000f00f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000009090909000f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000909090900000f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000909090900f00f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000909090900f0000f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000009090909f000000f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
